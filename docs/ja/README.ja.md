# merge-room 日本語ドキュメント

> **英語版（正）**: [README.md](../../README.md)

merge-room は、コード変更がプルリクエストになる前に議論・レビュー・決定を行うワークスペースです。

### なぜ merge-room を作るのか
現代の開発で遅いのは「コードを書くこと」よりも、**同意（合意形成）コスト**です。  
差分・議論・決定理由が Slack / PR / 個人メモに散ることで、次が毎回発生します。

- 何を見て話しているかの再確認（座標合わせ）
- 追加情報の要求と提供
- コンテキストの再読
- 非同期の待ち時間による滞留

**merge-room は PR になる前の上流ワークスペース**として、一次情報（diff）・議論（引用付きスレッド）・決定（明示的な判断）を1画面に束ね、合意のための摩擦を最小化します。

### コアアイデア：PRは出口
merge-room は GitHub を置き換えません。  
Pull Request を本来の役割である **最終確定の台帳（出口）** に戻すためのツールです。

---

### merge-room が最適化するもの
merge-room は「1回で同意が取れる」こと自体は保証しません（判断するのは人間なので）。  
代わりに、ツールが制御できる部分を最適化します。

- **同意1回あたりの摩擦を限りなく小さくする（ほぼゼロを目標）**
  - 1画面で完結：差分（主役）/ スレッド / 決定 / エクスポート
  - 議論は差分の引用（アンカー）に紐づくため、「どこ？何？」が減る
  - 決定を明示（Summary / Rationale / Risks / Rollback）し、質問往復を先回りする
  - Private AI Notes を分離し、公開議論や Export に混ぜない

- **2回目・3回目の往復を安くする**
  - 「話題の座標」（引用アンカー＋決定）が残るため、再読・再説明が減る
  - Export が PR 本文として使えるため、出口で迷いにくい

---

### 意図的に最適化しないもの（非目標）
merge-room を長持ちさせてブレさせないために、あえてやりません。

- **“リアルタイム性で回転数を上げる” 機能**（チャット化・通知地獄を避ける）
- GitHub の責務の置き換え（認証・権限・マージ制御・監査/コンプラ等）
- リアルタイム複数人編集 / Slack の代替
- IDEを飲み込む統合（統合するなら入口/出口の薄い連携に留める）

---

### うまくいっているかの判定（成功シグナル）
実際の変更で1回使った後、次が成り立つほど「上流ツールとして有効」です。

1. Export した Markdown を PR 本文に貼れた（できれば最小限の編集で）
2. Decision 4項目が「手間」より「整理の助け」になった
3. レビューが“追加説明要求”から“判断（YES/NO）”に寄った
4. diff refresh 後も引用アンカーの信頼が保てた（stale 警告が適切に効く）
   
## コンセプト

- **高速イテレーション**はプライベートに（AIと共に）
- **議論**は同期的に
- **PRは出口（最終確定点）**であり、議論の場ではない

## ドキュメント一覧

| ドキュメント | 内容 |
|-------------|------|
| [runbook.ja.md](./runbook.ja.md) | クイックスタート・トラブルシューティング・成功判定 |
| [architecture.ja.md](./architecture.ja.md) | UI構造・データモデル・API一覧 |
| [decision.ja.md](./decision.ja.md) | 検証仮説・実装済み機能・投資判断 |

## クイックスタート

```bash
# 前提: Node.js 20+, pnpm, C++ビルドツール

cd web
pnpm install
pnpm demo:seed   # デモ用gitリポジトリを作成
pnpm dev         # 開発サーバー起動
```

http://localhost:5173 を開く

詳細な手順は [runbook.ja.md](./runbook.ja.md) を参照。

## 主要機能

- **タスク（Task）管理**: ローカルgitリポジトリに紐付けたタスクを作成
- **差分ビューア**: staged/unstaged/untracked の変更を表示
- **アンカー（Anchor：差分引用）**: 差分の行範囲を選択してコメント（Comment）に引用
- **スレッド（Thread）**: コード選択部分にスレッドを作成、返信
- **プライベートノート**: エクスポート（Export）に含まれないAIメモ用タブ
- **決定（Decision）**: 承認（Approved）前に必須の4項目（Summary/Rationale/Risks/Rollback）
- **PRドラフトエクスポート**: 決定＋スレッドをMarkdownで出力

## ステータスワークフロー

```
下書き（Draft）→ レビュー（Review）→ 承認済み（Approved）→ アーカイブ（Archived）
                                ↑
                        決定（Decision）の4項目が必須
```

## 技術スタック

- **Frontend**: Vite + React + TypeScript + Zustand
- **Backend**: Express + better-sqlite3
- **外部連携なし**: ローカルgitのみ、GitHub API/認証なし

## 関連リンク

- [英語版 README](../../README.md)
- [実装ノート](../notes.md)（英語）
