# merge-room 投資判断

> **英語版（正）**: [decision.md](../decision.md)

## 検証中の仮説（3つ）

### 1. Pre-PRワークスペースがレビュー摩擦を軽減する

従来のPRはイテレーションと議論が混在している。「プライベートなイテレーション（AIと）」と「同期的な議論」を分離し、PRを最終確定のみに使うことで：
- 設計決定への収束が速くなる
- エクスポート（Export）に明確な根拠が残る

### 2. 決定ドキュメント必須化が承認品質を向上させる

承認（Approved）前に summary/rationale/risks/rollback の記入を強制することで：
- 作成者が意図を明示的に言語化する
- 「読まずにLGTM」の承認が減る
- 将来のデバッグ用の監査証跡が残る

### 3. 行アンカー付き議論が文脈を保つ

コメント（Comment）を特定の差分行（hunk相対インデックス）にアンカー（Anchor：差分引用）することで：
- コードが変更されても議論の文脈が維持される
- 意味のあるPR説明文へのエクスポートが可能になる

## 実装済み機能

- **タスク（Task）管理**: ローカルgitリポジトリに紐付けたタスク作成、ステータスワークフロー（draft → review → approved → archived）
- **差分ビューア**: staged/unstaged/untracked の変更表示、折りたたみ可能なファイルセクション
- **行選択**: 差分の行範囲を選択してコメントに引用（anchor = filePath + hunkIndex + line indices）
- **スレッド（Thread）議論**: コード選択部分にスレッド作成、既存スレッドへの返信
- **プライベートAIノート**: エクスポートに含まれないノート用の別タブ
- **決定（Decision）ゲート**: 4項目すべて記入しないと承認不可（サーバー側で強制、400エラー）
- **PRドラフトエクスポート**: 決定＋スレッド＋アンカーをMarkdownで生成、クリップボードコピー＋docs/pr-drafts/に保存
- **E2Eテスト**: ネガティブ承認テストを含む自動スモークテスト

## 意図的に未実装

| 機能 | 理由 |
|------|------|
| 認証 | シングルユーザーのspike、ローカル専用 |
| マルチユーザー | 検証に同時編集不要 |
| リアルタイム同期 | spikeにはポーリングで十分 |
| GitHub API | ワークフロー検証が目的、連携は対象外 |
| Slack通知 | スコープ外 |
| シンタックスハイライト | 検証にはプレーンテキストで十分 |
| 画像/バイナリ差分 | 現時点ではテキストのみ |

## 次の検証ステップ

1. **内部でドッグフード**: 投資前に2〜3件の実コード変更でmerge-roomを使用
2. **ペインポイント収集**: 差分が変わるとアンカーシステムは壊れるか？
3. **GitHub連携の価値評価**: 手動コピペで許容可能か、API同期が必須か？
4. **コラボレーション検討**: シングルユーザーで十分か、レビューにマルチユーザーが必要か？

## 判断

内部検証待ち。アーキテクチャについては `docs/notes.md` を参照。
